import{Aa as G,K as c,O as l,P as u,R as W,Ra as Be,a,b as m,ba as ve,c as M,fa as ce,ga as g,ha as y,ia as le,ka as N,ma as ge,na as _,pa as ye,ra as K,sa as E,ta as L,va as U,wa as V,xa as Ce}from"./chunk-OZ42HCLA.js";var p=(()=>{let e=class e{constructor(){this.state=y({canvas:null}),this.canvas=g(()=>this.state().canvas),this.context=g(()=>this.canvas()?.getContext("2d")),this.canvasWidth=y(0)}initialize(t){this.state.set(m(a({},this.state),{canvas:t})),this.clearCanvas()}resize(t,i){let{canvas:r}=this.state();r&&(r.width=t,r.height=i,this.canvasWidth.set(t),this.state.set(m(a({},this.state()),{canvas:r})))}clearCanvas(){this.context().clearRect(0,0,this.canvas().width,this.canvas().height)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var j=Symbol("STATE_SIGNAL");function we(s,...e){s[j].update(n=>e.reduce((t,i)=>a(a({},t),typeof i=="function"?i(t):i),n))}function be(s){let e=le(()=>s());return qe(e)?new Proxy(s,{get(n,t){return t in e?(ce(n[t])||Object.defineProperty(n,t,{value:g(()=>n()[t]),configurable:!0}),be(n[t])):n[t]}}):s}function qe(s){return s?.constructor===Object}function Q(...s){let e=[...s],n="providedIn"in e[0]?e.shift():{},t=e;return(()=>{class r{constructor(){let d=t.reduce(($,Pe)=>Pe($),Ke()),{slices:f,signals:I,methods:F,hooks:ae}=d,fe=a(a(a({},f),I),F);this[j]=d[j];for(let $ in fe)this[$]=fe[$];let{onInit:pe,onDestroy:Se}=ae;pe&&pe(),Se&&u(ge).onDestroy(Se)}static \u0275fac=function(f){return new(f||r)};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:n.providedIn||null})}return r})()}function Ke(){return{[j]:y({}),slices:{},signals:{},methods:{},hooks:{}}}function A(s,e){return Object.keys(s).reduce((n,t)=>e.includes(t)?n:m(a({},n),{[t]:s[t]}),{})}function he(s){return e=>{let n=s(a(a({},e.slices),e.signals)),t=Object.keys(n),i=A(e.slices,t),r=A(e.methods,t);return m(a({},e),{slices:i,signals:a(a({},e.signals),n),methods:r})}}function R(s){return e=>{let n=s(a(a(a({[j]:e[j]},e.slices),e.signals),e.methods)),t=Object.keys(n),i=A(e.slices,t),r=A(e.signals,t);return m(a({},e),{slices:i,signals:r,methods:a(a({},e.methods),n)})}}function D(s){return e=>{let n=typeof s=="function"?s():s,t=Object.keys(n);e[j].update(d=>a(a({},d),n));let i=t.reduce((d,f)=>{let I=g(()=>e[j]()[f]);return m(a({},d),{[f]:be(I)})},{}),r=A(e.signals,t),o=A(e.methods,t);return m(a({},e),{slices:a(a({},e.slices),i),signals:r,methods:o})}}var ke=y({}),de=new Set,Ie=!1;function Ee(){_(()=>{if(!X)return;let s=ke(),e={};for(let i in s){let r=s[i];e[i]=r()}let n=Array.from(de),t=n.length?n.join(", "):"Store Update";de=new Set,X.send({type:t},e)})}function Te(s,e){if(typeof s=="object"&&s&&e in s)return s[e]}function _e(s){let[e]=Object.getOwnPropertySymbols(s);if(!e)throw new Error("Cannot find State Signal");return Te(s,e)}var X;function Y(s){return e=>{if(Be(u(ve)))return e;let t=window.__REDUX_DEVTOOLS_EXTENSION__;if(!t)return e;X||(X=t.connect({name:"NgRx Signal Store"}));let i=_e(e);return ke.update(r=>m(a({},r),{[s]:i})),Ie||(Ee(),Ie=!0),e}}var T=(s,e,...n)=>(de.add(e),we(s,...n));var Z=(()=>{let e=class e{static getChessBoardState(t){return t.split(" ")[0].split("/").reduce((o,d,f)=>(this.getPiecesRow(d).forEach((F,ae)=>{F&&(o[f][ae]=F)}),o),ue())}static getPiecesRow(t){return t.split("").reduce((r,o)=>!isNaN(Number(o))?[...r,...Array(Number(o)).fill(null)]:[...r,o],[])}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var je=["1","2","3","4","5","6","7","8"],ze=["a","b","c","d","e","f","g","h"],ue=()=>new Array(je.length).fill(null).map(()=>new Array(ze.length).fill(null)),Ae={pieces:ue(),verticalCoordinates:je,horizontalCoordinates:ze,isWhiteOnBottom:!0},C=Q({providedIn:"root"},Y("Chess Board"),D(Ae),he(s=>({verticalCoordinatesSorted:g(()=>s.isWhiteOnBottom()?[...s.verticalCoordinates()].reverse():s.verticalCoordinates()),horizontalCoordinatesSorted:g(()=>s.isWhiteOnBottom()?s.horizontalCoordinates():[...s.horizontalCoordinates()].reverse())})),R(s=>({initialize(e){T(s,"[Chess Board] Initialize chess board",n=>m(a({},n),{pieces:Z.getChessBoardState(e.fenString),isWhiteOnBottom:e.isWhiteOnBottom}))},toggleIsWhiteOnBottom(){T(s,"[Chess Board] Toggle is white on bottom",e=>m(a({},e),{isWhiteOnBottom:!e.isWhiteOnBottom}))},getPiece(e){let n=[...s.pieces()];return s.isWhiteOnBottom()||(n=n.reverse().map(t=>[...t].reverse())),n[e.vertical]?n[e.vertical][e.horizontal]:null}})));var B=function(s){return s.Classic="classic",s.Metal="metal",s}(B||{});var w=function(s){return s.Classic="classic",s.Glass="glass",s}(w||{});var z=class z{};z.themes={[w.Classic]:{lightSquareColor:"rgb(237, 238, 209)",darkSquareColor:"rgb(119, 152, 83)"},[w.Glass]:{lightSquareColor:"rgb(104, 113, 129)",darkSquareColor:"rgb(40, 47, 59)"}},z.\u0275fac=function(n){return new(n||z)},z.\u0275prov=c({token:z,factory:z.\u0275fac});var x=z;var h=function(s){return s.R="R",s.N="N",s.B="B",s.Q="Q",s.K="K",s.P="P",s.r="r",s.n="n",s.b="b",s.q="q",s.k="k",s.p="p",s}(h||{});var P=class P{};P.themes={[B.Classic]:{[h.R]:"assets/chess-pieces-themes/classic/classic_piece_r_light.svg",[h.N]:"assets/chess-pieces-themes/classic/classic_piece_n_light.svg",[h.B]:"assets/chess-pieces-themes/classic/classic_piece_b_light.svg",[h.Q]:"assets/chess-pieces-themes/classic/classic_piece_q_light.svg",[h.K]:"assets/chess-pieces-themes/classic/classic_piece_k_light.svg",[h.P]:"assets/chess-pieces-themes/classic/classic_piece_p_light.svg",[h.r]:"assets/chess-pieces-themes/classic/classic_piece_r_dark.svg",[h.n]:"assets/chess-pieces-themes/classic/classic_piece_n_dark.svg",[h.b]:"assets/chess-pieces-themes/classic/classic_piece_b_dark.svg",[h.q]:"assets/chess-pieces-themes/classic/classic_piece_q_dark.svg",[h.k]:"assets/chess-pieces-themes/classic/classic_piece_k_dark.svg",[h.p]:"assets/chess-pieces-themes/classic/classic_piece_p_dark.svg"},[B.Metal]:{[h.R]:"assets/chess-pieces-themes/metal/metal_piece_r_light.png",[h.N]:"assets/chess-pieces-themes/metal/metal_piece_n_light.png",[h.B]:"assets/chess-pieces-themes/metal/metal_piece_b_light.png",[h.Q]:"assets/chess-pieces-themes/metal/metal_piece_q_light.png",[h.K]:"assets/chess-pieces-themes/metal/metal_piece_k_light.png",[h.P]:"assets/chess-pieces-themes/metal/metal_piece_p_light.png",[h.r]:"assets/chess-pieces-themes/metal/metal_piece_r_dark.png",[h.n]:"assets/chess-pieces-themes/metal/metal_piece_n_dark.png",[h.b]:"assets/chess-pieces-themes/metal/metal_piece_b_dark.png",[h.q]:"assets/chess-pieces-themes/metal/metal_piece_q_dark.png",[h.k]:"assets/chess-pieces-themes/metal/metal_piece_k_dark.png",[h.p]:"assets/chess-pieces-themes/metal/metal_piece_p_dark.png"}},P.\u0275fac=function(n){return new(n||P)},P.\u0275prov=c({token:P,factory:P.\u0275fac});var q=P;var Oe={chessPiecesTheme:q.themes[B.Classic],chessBoardTheme:x.themes[w.Classic]},b=Q({providedIn:"root"},Y("Account"),D(Oe),R(s=>({initialize(e){T(s,"[Account] Initialize account",n=>m(a({},n),{chessPiecesTheme:q.themes[e.chessPiecesTheme],chessBoardTheme:x.themes[e.chessBoardTheme]}))},setChessBoardTheme(e){T(s,"[Account] Set chess board theme",n=>m(a({},n),{chessBoardTheme:x.themes[e]}))},setChessPiecesTheme(e){T(s,"[Account] Set chess pieces theme",n=>m(a({},n),{chessPiecesTheme:q.themes[e]}))}})));var v=(()=>{let e=class e{constructor(t){this.chessBoardCanvas=t}set cursor(t){this.chessBoardCanvas.canvas().style.cursor=t}getCursorPoint(t){let r=this.chessBoardCanvas.canvas().getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}getSquareSize(){return Math.floor(this.chessBoardCanvas.canvasWidth()/8)}getUnfilledBoardArea(){let t=this.getSquareSize();return Math.floor((this.chessBoardCanvas.canvasWidth()-t*8)/2)}getSquareCoordinates(t){let i=this.getSquareSize();return{vertical:Math.floor(t.y/i),horizontal:Math.floor(t.x/i)}}};e.\u0275fac=function(i){return new(i||e)(l(p))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var J=(()=>{let e=class e{constructor(t,i){this.chessBoardCanvas=t,this.canvasHelper=i,this.accountStore=u(b)}draw(t){let i=this.accountStore.chessBoardTheme(),r=this.isDarkSquare(t.vertical+t.horizontal)?i.lightSquareColor:i.darkSquareColor,o=this.chessBoardCanvas.context(),d=this.canvasHelper.getSquareSize(),f=this.canvasHelper.getUnfilledBoardArea();o.fillStyle=r,o.textBaseline="top",o.fillRect(f+t.horizontal*d,f+t.vertical*d,d,d)}isDarkSquare(t){return t%2===0}};e.\u0275fac=function(i){return new(i||e)(l(p),l(v))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var ee=(()=>{let e=class e{constructor(t,i){this.chessBoardCanvas=t,this.canvasHelper=i,this.chessBoardStore=u(C),this.accountStore=u(b)}draw(t){let i=t.horizontal===0,r=t.vertical===7;i&&this.drawVerticalCoordinate(t),r&&this.drawHorizontalCoordinate(t)}drawVerticalCoordinate(t){let i=this.chessBoardCanvas.context(),r=this.canvasHelper.getSquareSize(),o=this.canvasHelper.getUnfilledBoardArea(),d=this.chessBoardStore.verticalCoordinatesSorted()[t.vertical],f=o+t.horizontal*r+r/16,I=o+t.vertical*r+r/16;i.font=this.getFont(),i.fillStyle=this.getColor(t),i.textBaseline="top",i.textAlign="left",i.fillText(d,f,I)}drawHorizontalCoordinate(t){let i=this.chessBoardCanvas.context(),r=this.canvasHelper.getSquareSize(),o=this.chessBoardCanvas.canvasWidth()-r*8,d=this.chessBoardStore.horizontalCoordinatesSorted()[t.horizontal],f=o/2+t.horizontal*r+r-r/16,I=o/2+t.vertical*r+r-r/16;i.font=this.getFont(),i.fillStyle=this.getColor(t),i.textBaseline="alphabetic",i.textAlign="right",i.fillText(d,f,I)}getFont(){return`bold ${this.canvasHelper.getSquareSize()/4.5}px Arial`}getColor(t){let i=this.accountStore.chessBoardTheme();return this.isDarkSquare(t.vertical+t.horizontal)?i.darkSquareColor:i.lightSquareColor}isDarkSquare(t){return t%2===0}};e.\u0275fac=function(i){return new(i||e)(l(p),l(v))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var O=(()=>{let e=class e{constructor(){this.loaded=y(!1),this.accountStore=u(b),this.images=y({}),this.loadImage=t=>M(this,null,function*(){let i=new Image;return i.src=this.accountStore.chessPiecesTheme()[t],new Promise((r,o)=>{i.onload=()=>{r(i),this.images.set(m(a({},this.images()),{[t]:i}))},i.onerror=()=>{o(),this.images.set(m(a({},this.images()),{[t]:i}))}})}),this.loadImages=()=>M(this,null,function*(){this.loaded.set(!1);for(let t in this.accountStore.chessPiecesTheme())yield this.loadImage(t);this.loaded.set(!0)}),_(()=>M(this,null,function*(){return this.loadImages()}),{allowSignalWrites:!0})}getImage(t){return this.images()[t]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var te=(()=>{let e=class e{constructor(t,i,r){this.canvasHelper=t,this.chessBoardCanvas=i,this.pieceImage=r,this.chessBoardStore=u(C)}draw(t){let i=this.chessBoardStore.getPiece(t);if(!i)return;let r=this.chessBoardCanvas.context(),o=this.canvasHelper.getSquareSize(),d=this.canvasHelper.getUnfilledBoardArea(),f=this.pieceImage.getImage(i);r.drawImage(f,d+t.horizontal*o,d+t.vertical*o,o,o)}};e.\u0275fac=function(i){return new(i||e)(l(v),l(p),l(O))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var se=(()=>{let e=class e{constructor(t,i,r){this.drawSquareBackground=t,this.drawSquareCoordinates=i,this.drawSquarePiece=r}draw(t){this.drawSquareBackground.draw(t),this.drawSquareCoordinates.draw(t),this.drawSquarePiece.draw(t)}};e.\u0275fac=function(i){return new(i||e)(l(J),l(ee),l(te))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var ie=(()=>{let e=class e{constructor(t){this.drawSquare=t,this.chessBoardStore=u(C)}execute(){this.chessBoardStore.horizontalCoordinatesSorted().forEach((t,i)=>{this.chessBoardStore.verticalCoordinatesSorted().forEach((r,o)=>{this.drawSquare.draw({vertical:i,horizontal:o})})})}};e.\u0275fac=function(i){return new(i||e)(l(se))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var re=(()=>{let e=class e{constructor(t,i){this.chessBoardCanvas=t,this.canvasHelper=i,this.accountStore=u(b),this.frameWidth=2}draw(t,i="white"){let r=this.chessBoardCanvas.context(),o=this.canvasHelper.getSquareSize(),d=this.canvasHelper.getUnfilledBoardArea();t.vertical>=0&&t.vertical<=7&&t.horizontal>=0&&t.horizontal<=7&&(r.beginPath(),r.strokeStyle=i,r.lineWidth=this.frameWidth,r.strokeRect(d+t.horizontal*o+this.frameWidth/2,d+t.vertical*o+this.frameWidth/2,o-this.frameWidth,o-this.frameWidth),r.closePath())}clear(t){let i=this.accountStore.chessBoardTheme(),r=this.isDarkSquare(t.vertical+t.horizontal)?i.lightSquareColor:i.darkSquareColor;this.draw(t,r)}isDarkSquare(t){return t%2===0}};e.\u0275fac=function(i){return new(i||e)(l(p),l(v))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var ne=(()=>{let e=class e{constructor(t,i,r){this.chessBoardCanvas=t,this.drawSquareFrame=i,this.canvasHelper=r,this.chessBoardStore=u(C),this._previousSquare=null}get previousSquare(){return this._previousSquare}set previousSquare(t){this._previousSquare=t}execute(){let t=this.chessBoardCanvas.canvas();t.addEventListener("mouseenter",()=>{t.addEventListener("mousemove",this.handleMouseMove.bind(this))}),t.addEventListener("mouseleave",()=>{t.removeEventListener("mousemove",this.handleMouseMove.bind(this)),this.previousSquare&&(this.drawSquareFrame.clear(this.previousSquare),this.previousSquare=null)})}handleMouseMove(t){let i=this.canvasHelper.getCursorPoint(t),r=this.canvasHelper.getSquareCoordinates(i),o=this.chessBoardStore.getPiece(r);this.isSquareChanged(r)&&(this.drawSquareFrame.draw(r),this.canvasHelper.cursor=o?"pointer":"default",this.previousSquare&&this.drawSquareFrame.clear(this.previousSquare),this.previousSquare=r)}isSquareChanged(t){return t.vertical!==this.previousSquare?.vertical||t.horizontal!==this.previousSquare?.horizontal}};e.\u0275fac=function(i){return new(i||e)(l(p),l(re),l(v))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var oe=(()=>{let e=class e{constructor(t,i,r,o){this.chessBoardCanvas=t,this.drawChessBoardService=i,this.initializeHoverEffect=r,this.pieceImage=o,_(()=>this.drawChessBoard())}execute(t){this.chessBoardCanvas.initialize(t),this.drawChessBoard()}drawChessBoard(){!this.pieceImage.loaded()||!this.chessBoardCanvas.canvas()||(this.drawChessBoardService.execute(),this.initializeHoverEffect.execute())}};e.\u0275fac=function(i){return new(i||e)(l(p),l(ie),l(ne),l(O))},e.\u0275prov=c({token:e,factory:e.\u0275fac});let s=e;return s})();var me=(()=>{let e=class e{constructor(t,i,r){this.initializeChessBoardView=t,this.chessBoardCanvas=i,this.zone=r,this.chessBoardStore=u(C),this.accountStore=u(b)}ngOnInit(){this.chessBoardStore.initialize({fenString:`r1bqk2r/ppppn1pp/2n2p2/8/2B1P3/8/PPPP1PPP/R1BQK1NR b KQkq - 2 6
`,isWhiteOnBottom:!0}),this.accountStore.initialize({chessBoardTheme:w.Glass,chessPiecesTheme:B.Classic}),this.chessBoardCanvasObserver=new ResizeObserver(t=>{this.zone.run(()=>{let i=t[0].contentRect.width,r=t[0].contentRect.height;this.chessBoardCanvas.resize(i,r)})})}ngAfterViewInit(){let t=document.getElementById("chess-board-canvas");this.initializeChessBoardView.execute(t),this.chessBoardCanvasObserver.observe(t)}ngOnDestroy(){this.chessBoardCanvasObserver.disconnect()}toggle(){this.chessBoardStore.toggleIsWhiteOnBottom()}setChessBoardTheme(){this.accountStore.setChessBoardTheme(this.getRandomBoolean()?w.Classic:w.Glass)}setChessPiecesTheme(){this.accountStore.setChessPiecesTheme(this.getRandomBoolean()?B.Metal:B.Classic)}getRandomBoolean(){return Math.random()<.5}};e.\u0275fac=function(i){return new(i||e)(N(oe),N(p),N(ye))},e.\u0275cmp=W({type:e,selectors:[["ca-chess-board"]],standalone:!0,features:[Ce([p,oe,ie,Z,q,x,ne,re,v,J,ee,se,te,O]),G],decls:9,vars:0,consts:[[1,"buttons"],[3,"click"],[1,"canvas-container"],["id","chess-board-canvas","width","400","height","400"]],template:function(i,r){i&1&&(K(0,"div",0)(1,"button",1),U("click",function(){return r.toggle()}),V(2,"Click me"),E(),K(3,"button",1),U("click",function(){return r.setChessBoardTheme()}),V(4,"Click me"),E(),K(5,"button",1),U("click",function(){return r.setChessPiecesTheme()}),V(6,"Click me"),E()(),K(7,"div",2),L(8,"canvas",3),E())},styles:[".canvas-container[_ngcontent-%COMP%]{width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;aspect-ratio:1}.buttons[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]});let s=e;return s})();var js=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=W({type:e,selectors:[["app-game"]],standalone:!0,features:[G],decls:3,vars:0,consts:[[1,"game-screen"],[1,"chess-board-container"]],template:function(i,r){i&1&&(K(0,"div",0)(1,"div",1),L(2,"ca-chess-board"),E()())},dependencies:[me],styles:[".game-screen[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100vh;display:flex;align-items:center;justify-content:center}.game-screen[_ngcontent-%COMP%]   .chess-board-container[_ngcontent-%COMP%]{width:100%;height:100%;max-width:600px;max-height:600px}"]});let s=e;return s})();export{js as GameComponent};
