import{Aa as V,K as a,O as l,P as d,R as W,Ra as Ce,a as c,b as m,ba as Se,c as R,fa as ce,ga as x,ha as z,ia as ae,ka as ge,ma as ve,na as E,ra as q,sa as P,ta as L,va as N,wa as U,xa as ye}from"./chunk-OZ42HCLA.js";var p=(()=>{let e=class e{get context(){return this._context}get canvas(){return this._canvas}get width(){return this.canvas.width}get height(){return this.canvas.height}setUpCanvas(t){let i=t.getContext("2d");this._canvas=t,i&&(this._context=i)}clearCanvas(){this.context.clearRect(0,0,this.width,this.height)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var B=Symbol("STATE_SIGNAL");function we(s,...e){s[B].update(n=>e.reduce((t,i)=>c(c({},t),typeof i=="function"?i(t):i),n))}function Be(s){let e=ae(()=>s());return qe(e)?new Proxy(s,{get(n,t){return t in e?(ce(n[t])||Object.defineProperty(n,t,{value:x(()=>n()[t]),configurable:!0}),Be(n[t])):n[t]}}):s}function qe(s){return s?.constructor===Object}function G(...s){let e=[...s],n="providedIn"in e[0]?e.shift():{},t=e;return(()=>{class r{constructor(){let u=t.reduce(($,ze)=>ze($),Pe()),{slices:S,signals:F,methods:H,hooks:oe}=u,me=c(c(c({},S),F),H);this[B]=u[B];for(let $ in me)this[$]=me[$];let{onInit:fe,onDestroy:pe}=oe;fe&&fe(),pe&&d(ve).onDestroy(pe)}static \u0275fac=function(S){return new(S||r)};static \u0275prov=a({token:r,factory:r.\u0275fac,providedIn:n.providedIn||null})}return r})()}function Pe(){return{[B]:z({}),slices:{},signals:{},methods:{},hooks:{}}}function T(s,e){return Object.keys(s).reduce((n,t)=>e.includes(t)?n:m(c({},n),{[t]:s[t]}),{})}function le(s){return e=>{let n=s(c(c({},e.slices),e.signals)),t=Object.keys(n),i=T(e.slices,t),r=T(e.methods,t);return m(c({},e),{slices:i,signals:c(c({},e.signals),n),methods:r})}}function O(s){return e=>{let n=s(c(c(c({[B]:e[B]},e.slices),e.signals),e.methods)),t=Object.keys(n),i=T(e.slices,t),r=T(e.signals,t);return m(c({},e),{slices:i,signals:r,methods:c(c({},e.methods),n)})}}function A(s){return e=>{let n=typeof s=="function"?s():s,t=Object.keys(n);e[B].update(u=>c(c({},u),n));let i=t.reduce((u,S)=>{let F=x(()=>e[B]()[S]);return m(c({},u),{[S]:Be(F)})},{}),r=T(e.signals,t),o=T(e.methods,t);return m(c({},e),{slices:c(c({},e.slices),i),signals:r,methods:o})}}var Ie=z({}),he=new Set,be=!1;function Ke(){E(()=>{if(!Q)return;let s=Ie(),e={};for(let i in s){let r=s[i];e[i]=r()}let n=Array.from(he),t=n.length?n.join(", "):"Store Update";he=new Set,Q.send({type:t},e)})}function _e(s,e){if(typeof s=="object"&&s&&e in s)return s[e]}function Ee(s){let[e]=Object.getOwnPropertySymbols(s);if(!e)throw new Error("Cannot find State Signal");return _e(s,e)}var Q;function X(s){return e=>{if(Ce(d(Se)))return e;let t=window.__REDUX_DEVTOOLS_EXTENSION__;if(!t)return e;Q||(Q=t.connect({name:"NgRx Signal Store"}));let i=Ee(e);return Ie.update(r=>m(c({},r),{[s]:i})),be||(Ke(),be=!0),e}}var _=(s,e,...n)=>(he.add(e),we(s,...n));var Y=(()=>{let e=class e{static getChessBoardState(t){return t.split(" ")[0].split("/").reduce((o,u,S)=>(this.getPiecesRow(u).forEach((H,oe)=>{H&&(o[S][oe]=H)}),o),de())}static getPiecesRow(t){return t.split("").reduce((r,o)=>!isNaN(Number(o))?[...r,...Array(Number(o)).fill(null)]:[...r,o],[])}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var ke=["1","2","3","4","5","6","7","8"],je=["a","b","c","d","e","f","g","h"],de=()=>new Array(ke.length).fill(null).map(()=>new Array(je.length).fill(null)),Te={pieces:de(),verticalCoordinates:ke,horizontalCoordinates:je,isWhiteOnBottom:!0},v=G({providedIn:"root"},X("Chess Board"),A(Te),le(s=>({verticalCoordinatesSorted:x(()=>s.isWhiteOnBottom()?[...s.verticalCoordinates()].reverse():s.verticalCoordinates()),horizontalCoordinatesSorted:x(()=>s.isWhiteOnBottom()?s.horizontalCoordinates():[...s.horizontalCoordinates()].reverse())})),O(s=>({initialize(e){_(s,"[Chess Board] Initialize chess board",n=>m(c({},n),{pieces:Y.getChessBoardState(e.fenString),isWhiteOnBottom:e.isWhiteOnBottom}))},toggleIsWhiteOnBottom(){_(s,"[Chess Board] Toggle is white on bottom",e=>m(c({},e),{isWhiteOnBottom:!e.isWhiteOnBottom}))},getPiece(e){let n=[...s.pieces()];return s.isWhiteOnBottom()||(n=n.reverse().map(t=>[...t].reverse())),n[e.vertical]?n[e.vertical][e.horizontal]:null}})));var y=function(s){return s.Classic="classic",s.Metal="metal",s}(y||{});var C=function(s){return s.Classic="classic",s.Glass="glass",s}(C||{});var b=class b{};b.themes={[C.Classic]:{lightSquareColor:"rgb(237, 238, 209)",darkSquareColor:"rgb(119, 152, 83)"},[C.Glass]:{lightSquareColor:"rgb(104, 113, 129)",darkSquareColor:"rgb(40, 47, 59)"}},b.\u0275fac=function(n){return new(n||b)},b.\u0275prov=a({token:b,factory:b.\u0275fac});var I=b;var h=function(s){return s.R="R",s.N="N",s.B="B",s.Q="Q",s.K="K",s.P="P",s.r="r",s.n="n",s.b="b",s.q="q",s.k="k",s.p="p",s}(h||{});var k=class k{};k.themes={[y.Classic]:{[h.R]:"assets/chess-pieces-themes/classic/classic_piece_r_light.svg",[h.N]:"assets/chess-pieces-themes/classic/classic_piece_n_light.svg",[h.B]:"assets/chess-pieces-themes/classic/classic_piece_b_light.svg",[h.Q]:"assets/chess-pieces-themes/classic/classic_piece_q_light.svg",[h.K]:"assets/chess-pieces-themes/classic/classic_piece_k_light.svg",[h.P]:"assets/chess-pieces-themes/classic/classic_piece_p_light.svg",[h.r]:"assets/chess-pieces-themes/classic/classic_piece_r_dark.svg",[h.n]:"assets/chess-pieces-themes/classic/classic_piece_n_dark.svg",[h.b]:"assets/chess-pieces-themes/classic/classic_piece_b_dark.svg",[h.q]:"assets/chess-pieces-themes/classic/classic_piece_q_dark.svg",[h.k]:"assets/chess-pieces-themes/classic/classic_piece_k_dark.svg",[h.p]:"assets/chess-pieces-themes/classic/classic_piece_p_dark.svg"},[y.Metal]:{[h.R]:"assets/chess-pieces-themes/metal/metal_piece_r_light.png",[h.N]:"assets/chess-pieces-themes/metal/metal_piece_n_light.png",[h.B]:"assets/chess-pieces-themes/metal/metal_piece_b_light.png",[h.Q]:"assets/chess-pieces-themes/metal/metal_piece_q_light.png",[h.K]:"assets/chess-pieces-themes/metal/metal_piece_k_light.png",[h.P]:"assets/chess-pieces-themes/metal/metal_piece_p_light.png",[h.r]:"assets/chess-pieces-themes/metal/metal_piece_r_dark.png",[h.n]:"assets/chess-pieces-themes/metal/metal_piece_n_dark.png",[h.b]:"assets/chess-pieces-themes/metal/metal_piece_b_dark.png",[h.q]:"assets/chess-pieces-themes/metal/metal_piece_q_dark.png",[h.k]:"assets/chess-pieces-themes/metal/metal_piece_k_dark.png",[h.p]:"assets/chess-pieces-themes/metal/metal_piece_p_dark.png"}},k.\u0275fac=function(n){return new(n||k)},k.\u0275prov=a({token:k,factory:k.\u0275fac});var j=k;var Me={chessPiecesTheme:j.themes[y.Classic],chessBoardTheme:I.themes[C.Classic]},w=G({providedIn:"root"},X("Account"),A(Me),O(s=>({initialize(e){_(s,"[Account] Initialize account",n=>m(c({},n),{chessPiecesTheme:j.themes[e.chessPiecesTheme],chessBoardTheme:I.themes[e.chessBoardTheme]}))},setChessBoardTheme(e){_(s,"[Account] Set chess board theme",n=>m(c({},n),{chessBoardTheme:I.themes[e]}))},setChessPiecesTheme(e){_(s,"[Account] Set chess pieces theme",n=>m(c({},n),{chessPiecesTheme:j.themes[e]}))}})));var g=(()=>{let e=class e{constructor(t){this.chessBoardCanvas=t}set cursor(t){this.chessBoardCanvas.canvas.style.cursor=t}getCursorPoint(t){let r=this.chessBoardCanvas.canvas.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}getSquareSize(){return this.chessBoardCanvas.width/8}getSquareCoordinates(t){let i=this.getSquareSize();return{vertical:Math.floor(t.y/i),horizontal:Math.floor(t.x/i)}}};e.\u0275fac=function(i){return new(i||e)(l(p))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var J=(()=>{let e=class e{constructor(t,i){this.chessBoardCanvas=t,this.canvasHelper=i,this.accountStore=d(w)}draw(t){let i=this.accountStore.chessBoardTheme(),r=this.isDarkSquare(t.vertical+t.horizontal)?i.lightSquareColor:i.darkSquareColor,o=this.chessBoardCanvas.context,u=this.canvasHelper.getSquareSize();o.fillStyle=r,o.textBaseline="top",o.fillRect(t.horizontal*u,t.vertical*u,u,u)}isDarkSquare(t){return t%2===0}};e.\u0275fac=function(i){return new(i||e)(l(p),l(g))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var Z=(()=>{let e=class e{constructor(t,i){this.chessBoardCanvas=t,this.canvasHelper=i,this.chessBoardStore=d(v),this.accountStore=d(w)}draw(t){let i=t.horizontal===0,r=t.vertical===7;i&&this.drawVerticalCoordinate(t),r&&this.drawHorizontalCoordinate(t)}drawVerticalCoordinate(t){let i=this.chessBoardCanvas.context,r=this.canvasHelper.getSquareSize(),o=this.chessBoardStore.verticalCoordinatesSorted()[t.vertical],u=t.horizontal*r+r/16,S=t.vertical*r+r/16;i.font=this.getFont(),i.fillStyle=this.getColor(t),i.textBaseline="top",i.textAlign="left",i.fillText(o,u,S)}drawHorizontalCoordinate(t){let i=this.chessBoardCanvas.context,r=this.canvasHelper.getSquareSize(),o=this.chessBoardStore.horizontalCoordinatesSorted()[t.horizontal],u=t.horizontal*r+r-r/16,S=t.vertical*r+r-r/16;i.font=this.getFont(),i.fillStyle=this.getColor(t),i.textBaseline="alphabetic",i.textAlign="right",i.fillText(o,u,S)}getFont(){return`bold ${this.canvasHelper.getSquareSize()/4.5}px Arial`}getColor(t){let i=this.accountStore.chessBoardTheme();return this.isDarkSquare(t.vertical+t.horizontal)?i.darkSquareColor:i.lightSquareColor}isDarkSquare(t){return t%2===0}};e.\u0275fac=function(i){return new(i||e)(l(p),l(g))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var M=(()=>{let e=class e{constructor(){this.loaded=z(!1),this.accountStore=d(w),this.images=z({}),this.loadImage=t=>R(this,null,function*(){let i=new Image;return i.src=this.accountStore.chessPiecesTheme()[t],new Promise((r,o)=>{i.onload=()=>{r(i),this.images.set(m(c({},this.images()),{[t]:i}))},i.onerror=()=>{o(),this.images.set(m(c({},this.images()),{[t]:i}))}})}),this.loadImages=()=>R(this,null,function*(){this.loaded.set(!1);for(let t in this.accountStore.chessPiecesTheme())yield this.loadImage(t);this.loaded.set(!0)}),E(()=>R(this,null,function*(){return this.loadImages()}),{allowSignalWrites:!0})}getImage(t){return this.images()[t]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var ee=(()=>{let e=class e{constructor(t,i,r){this.canvasHelper=t,this.chessBoardCanvas=i,this.pieceImage=r,this.chessBoardStore=d(v)}draw(t){let i=this.chessBoardStore.getPiece(t);if(!i)return;let r=this.chessBoardCanvas.context,o=this.canvasHelper.getSquareSize(),u=this.pieceImage.getImage(i);r.drawImage(u,t.horizontal*o,t.vertical*o,o,o)}};e.\u0275fac=function(i){return new(i||e)(l(g),l(p),l(M))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var te=(()=>{let e=class e{constructor(t,i,r){this.drawSquareBackground=t,this.drawSquareCoordinates=i,this.drawSquarePiece=r}draw(t){this.drawSquareBackground.draw(t),this.drawSquareCoordinates.draw(t),this.drawSquarePiece.draw(t)}};e.\u0275fac=function(i){return new(i||e)(l(J),l(Z),l(ee))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var se=(()=>{let e=class e{constructor(t){this.drawSquare=t,this.chessBoardStore=d(v)}execute(){this.chessBoardStore.horizontalCoordinatesSorted().forEach((t,i)=>{this.chessBoardStore.verticalCoordinatesSorted().forEach((r,o)=>{this.drawSquare.draw({vertical:i,horizontal:o})})})}};e.\u0275fac=function(i){return new(i||e)(l(te))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var ie=(()=>{let e=class e{constructor(t,i){this.chessBoardCanvas=t,this.canvasHelper=i,this.accountStore=d(w),this.frameWidth=2}draw(t,i="white"){let r=this.chessBoardCanvas.context,o=this.canvasHelper.getSquareSize();r.beginPath(),r.strokeStyle=i,r.lineWidth=this.frameWidth,r.strokeRect(t.horizontal*o+this.frameWidth/2,t.vertical*o+this.frameWidth/2,o-this.frameWidth,o-this.frameWidth),r.closePath()}clear(t){let i=this.accountStore.chessBoardTheme(),r=this.isDarkSquare(t.vertical+t.horizontal)?i.lightSquareColor:i.darkSquareColor;this.draw(t,r)}isDarkSquare(t){return t%2===0}};e.\u0275fac=function(i){return new(i||e)(l(p),l(g))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var re=(()=>{let e=class e{constructor(t,i,r){this.chessBoardCanvas=t,this.drawSquareFrame=i,this.canvasHelper=r,this.chessBoardStore=d(v),this._previousSquare=null}get previousSquare(){return this._previousSquare}set previousSquare(t){this._previousSquare=t}execute(){let t=this.chessBoardCanvas.canvas;t.addEventListener("mouseenter",()=>{t.addEventListener("mousemove",this.handleMouseMove.bind(this))}),t.addEventListener("mouseleave",()=>{t.removeEventListener("mousemove",this.handleMouseMove.bind(this)),this.previousSquare&&(this.drawSquareFrame.clear(this.previousSquare),this.previousSquare=null)})}handleMouseMove(t){let i=this.canvasHelper.getCursorPoint(t),r=this.canvasHelper.getSquareCoordinates(i),o=this.chessBoardStore.getPiece(r);this.isSquareChanged(r)&&(this.drawSquareFrame.draw(r),this.canvasHelper.cursor=o?"pointer":"default",this.previousSquare&&this.drawSquareFrame.clear(this.previousSquare),this.previousSquare=r)}isSquareChanged(t){return t.vertical!==this.previousSquare?.vertical||t.horizontal!==this.previousSquare?.horizontal}};e.\u0275fac=function(i){return new(i||e)(l(p),l(ie),l(g))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var ne=(()=>{let e=class e{constructor(t,i,r,o){this.chessBoardCanvas=t,this.drawChessBoardService=i,this.initializeHoverEffect=r,this.pieceImage=o,E(()=>this.drawChessBoard())}execute(t){this.chessBoardCanvas.setUpCanvas(t),this.chessBoardCanvas.clearCanvas(),this.drawChessBoard()}drawChessBoard(){!this.pieceImage.loaded()||!this.chessBoardCanvas.canvas||(this.drawChessBoardService.execute(),this.initializeHoverEffect.execute())}};e.\u0275fac=function(i){return new(i||e)(l(p),l(se),l(re),l(M))},e.\u0275prov=a({token:e,factory:e.\u0275fac});let s=e;return s})();var ue=(()=>{let e=class e{constructor(t){this.initializeChessBoardView=t,this.chessBoardStore=d(v),this.accountStore=d(w)}ngOnInit(){this.chessBoardStore.initialize({fenString:`r1bqk2r/ppppn1pp/2n2p2/8/2B1P3/8/PPPP1PPP/R1BQK1NR b KQkq - 2 6
`,isWhiteOnBottom:!0}),this.accountStore.initialize({chessBoardTheme:C.Glass,chessPiecesTheme:y.Classic})}ngAfterViewInit(){let t=document.getElementById("chess-board-canvas");this.initializeChessBoardView.execute(t)}toggle(){this.chessBoardStore.toggleIsWhiteOnBottom()}setChessBoardTheme(){this.accountStore.setChessBoardTheme(this.getRandomBoolean()?C.Classic:C.Glass)}setChessPiecesTheme(){this.accountStore.setChessPiecesTheme(this.getRandomBoolean()?y.Metal:y.Classic)}getRandomBoolean(){return Math.random()<.5}};e.\u0275fac=function(i){return new(i||e)(ge(ne))},e.\u0275cmp=W({type:e,selectors:[["ca-chess-board"]],standalone:!0,features:[ye([p,ne,se,Y,j,I,re,ie,g,J,Z,te,ee,M]),V],decls:9,vars:0,consts:[[1,"buttons"],[3,"click"],[1,"canvas-container"],["id","chess-board-canvas","width","600","height","600"]],template:function(i,r){i&1&&(q(0,"div",0)(1,"button",1),N("click",function(){return r.toggle()}),U(2,"Click me"),P(),q(3,"button",1),N("click",function(){return r.setChessBoardTheme()}),U(4,"Click me"),P(),q(5,"button",1),N("click",function(){return r.setChessPiecesTheme()}),U(6,"Click me"),P()(),q(7,"div",2),L(8,"canvas",3),P())},styles:[".canvas-container[_ngcontent-%COMP%]{width:100%;height:100%}.canvas-container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%}.buttons[_ngcontent-%COMP%]{position:absolute;top:0;left:0}"]});let s=e;return s})();var Bs=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=W({type:e,selectors:[["app-game"]],standalone:!0,features:[V],decls:3,vars:0,consts:[[1,"game-screen"],[1,"chess-board-container"]],template:function(i,r){i&1&&(q(0,"div",0)(1,"div",1),L(2,"ca-chess-board"),P()())},dependencies:[ue],styles:[".game-screen[_ngcontent-%COMP%]{width:100%;height:100%;min-height:100vh;display:flex;align-items:center;justify-content:center}.game-screen[_ngcontent-%COMP%]   .chess-board-container[_ngcontent-%COMP%]{width:600px;height:600px}"]});let s=e;return s})();export{Bs as GameComponent};
